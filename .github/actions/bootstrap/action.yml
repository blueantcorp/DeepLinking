name: bootstrap
description: bootstrap project descr

runs:
  using: composite
  steps:
  - uses: actions/checkout@v3

  # Cache Swift Package Manager
  - uses: actions/cache@v3
    with:
      path: .build
      key: ${{ runner.os }}-spm-${{ hashFiles('**/Package.resolved') }}
      restore-keys: |
        ${{ runner.os }}-spm-
  
  # Cache build artifacts
  - name: Cache build artifacts
    uses: mikehardy/buildcache-action@v2
    continue-on-error: true

  # Setup Ruby (bundle)
  - name: Setup Ruby (bundle)
    uses: ruby/setup-ruby@v1
    with:
      bundler-cache: true
      working-directory: ${{ github.workspace }}
      ruby-version: ${{ inputs.ruby-version }}
    env:
      BUNDLE_VERSION: ${{ inputs.bundler-version }}
      BUNDLE_GEMFILE: ${{ github.workspace }}/Gemfile
      BUNDLE_PATH: ${{ github.workspace }}/.vendor/bundle
      BUNDLE_JOBS: 4
      BUNDLE_RETRY: 3

  # Install Bundler
  - name: Install dependencies
    run: bundle install --jobs 4 --retry 3
    shell: bash

  # Install Swift tools
  - name: Generate Xcode project
    uses: xavierLowmiller/xcodegen-action@1.1.2
    with:
      spec: .xcodegen.yml